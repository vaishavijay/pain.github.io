{% extends 'layout.html' %}

{% block title %}
<title>Notes</title>
{% endblock %}

{% block content %}
<div class="container py-4">
    <header class="pb-3 mb-4 border-bottom border-primary text-dark">
        <span class="fs-4">Vent Journal</span>
    </header>
    <p style="position: absolute; width: 600px; left: 310px; top: 200px;">[Users can vent out any feelings from everyday life whenever and wherever they feel like it. All information will be saved and users can be ensured that their information is private and secured as soon as they login.]</p>

</div>
    <form style="position: absolute; left: 300px; top: 300px;" method="POST" ID="create" action={{url_for('notes.create')}}>
        <table class="table">
            <thead>
            <tr>
                <th><label for="notes">Create a new note:</label></th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td><textarea style="width: 600px;" rows = "10" cols = "100%" name = "notes" id="notes" required></textarea></td>
                <td><input style="position: absolute; left: 620px; top: 100px;" type="submit" value="Add" ></td>
            </tr>
            </tbody>

        </table>
        <p style="position: absolute">Draw anything you want</p>
        <tr>
        <td><canvas style="position: absolute; width: 600px; height: 300px; border:1px solid #000000;" id="canvas"></canvas></td>
        </tr>
    </form>



<div style="position: absolute;width: 775px;height: 780px; top: 160px; left: 1000px;" class="container py-4 text-light bg-success">
    <div class="container bg-secondary py-4">
        <div class="p-5 mb-4 bg-light text-dark rounded-3">
            <h2>Notes for {{ user.name }}</h2>
            <hr>
            <!--Notes input form, textarea supports multiple lines of input  -->

            <hr>
            <!--Notes output area, Jinja lines iterate through notes,
                note.note is html converted from markdown -->
            <div class="table-responsive">
                <table class="table">
                    <tbody>
                    {% for note in notes %}
                    <tr>
                        <td>{{ note.note | safe }}</td>
                    </tr>
                    {% endfor %}
                    </tbody>
                </table>
            </div>

        </div>
    </div>
</div>

<script>
    window.addEventListener('load', ()=>{

        resize(); // Resizes the canvas once the window loads
        document.addEventListener('mousedown', startPainting);
        document.addEventListener('mouseup', stopPainting);
        document.addEventListener('mousemove', sketch);
        window.addEventListener('resize', resize);
    });

    const canvas = document.querySelector('#canvas');

    // Context for the canvas for 2 dimensional operations
    const ctx = canvas.getContext('2d');

    // Resizes the canvas to the available size of the window.
    function resize(){
        ctx.canvas.width = window.innerWidth;
        ctx.canvas.height = window.innerHeight;
    }

    // Stores the initial position of the cursor
    let coord = {x:0 , y:0};

    // This is the flag that we are going to use to
    // trigger drawing
    let paint = false;

    // Updates the coordianates of the cursor when
    // an event e is triggered to the coordinates where
    // the said event is triggered.
    function getPosition(event){
        coord.x = event.clientX - canvas.offsetLeft;
        coord.y = event.clientY - canvas.offsetTop;
    }

    // The following functions toggle the flag to start
    // and stop drawing
    function startPainting(event){
        paint = true;
        getPosition(event);
    }
    function stopPainting(){
        paint = false;
    }

    function sketch(event){
        if (!paint) return;
        ctx.beginPath();

        ctx.lineWidth = 5;

        // Sets the end of the lines drawn
        // to a round shape.
        ctx.lineCap = 'round';

        ctx.strokeStyle = 'green';

        // The cursor to start drawing
        // moves to this coordinate
        ctx.moveTo(coord.x, coord.y);

        // The position of the cursor
        // gets updated as we move the
        // mouse around.
        getPosition(event);

        // A line is traced from start
        // coordinate to this coordinate
        ctx.lineTo(coord.x , coord.y);

        // Draws the line.
        ctx.stroke();
    }
</script>
{% endblock %}