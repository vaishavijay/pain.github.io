{% extends "layout.html" %}
{% block content %}
    <h1>Draw something</h1>
    <p>Drawing can help reduce stress!</p>
    <canvas id="theCanvas"></canvas>
    <div>
        <button class="button clearButton" id="clearButton">Clear</button>
    </div>
    <style>#theCanvas {
        height: 400px;
        width: 400px;
        background: white;
    }
    .clearButton {background-color: #b99f7a;} /* Tan */

    body {
        background: #eee;
    }</style>
    <script>const MAIN_MOUSE_BUTTON = 0;

    function prepareContext(canvasElement) {
        let dpr = window.devicePixelRatio || 1;
        let rect = canvasElement.getBoundingClientRect();
        canvasElement.width = rect.width * dpr;
        canvasElement.height = rect.height * dpr;

        let context = canvasElement.getContext("2d");
        context.scale(dpr, dpr);

        return context;
    }

    function setLineProperties(context) {
        context.lineWidth = 4;
        context.lineJoin = "round";
        context.lineCap = "round";
        return context;
    }

    let clearButton = document.getElementById("clearButton");
    let theCanvas = document.getElementById("theCanvas");
    let theContext = prepareContext(theCanvas);
    let shouldDraw = false;

    theCanvas.addEventListener("mousedown", start);
    theCanvas.addEventListener("mouseup", end);
    theCanvas.addEventListener("mousemove", move, false);

    clearButton.addEventListener("click", event => {
        clearCanvas(theContext);
    });


    function clearCanvas(context) {
        context.clearRect(0, 0, context.canvas.width, context.canvas.height);
    }

    function start(event) {
        if (event.button === MAIN_MOUSE_BUTTON) {
            shouldDraw = true;
            setLineProperties(theContext);

            theContext.beginPath();

            let elementRect = event.target.getBoundingClientRect();
            theContext.moveTo(event.clientX - elementRect.left, event.clientY - elementRect.top);
        }
    }

    function end(event) {
        if (event.button === MAIN_MOUSE_BUTTON) {
            shouldDraw = false;
        }
    }

    function move(event) {
        if (shouldDraw) {
            let elementRect = event.target.getBoundingClientRect();
            theContext.lineTo(event.clientX - elementRect.left, event.clientY - elementRect.top);
            theContext.stroke()
        }
    }</script>
    {#<section class="container">
    <div id="toolbar">
        <h1>Draw.</h1>
        <label for="stroke">Stroke</label>
        <input id="stroke" name='stroke' type="color">
        <label for="lineWidth">Line Width</label>
        <input id="lineWidth" name='lineWidth' type="number" value="5">
        <button id="clear">Clear</button>
    </div>
    <div>
        <canvas id="drawing-board"></canvas>
    </div>
</section>
    <script src="./index.js"></script>
<style>
    body {
        margin: 0;
        padding: 0;
        height: 100%;
        overflow: hidden;
        color: white;
    }
    h1 {
        background: #7F7FD5;
        background: -webkit-linear-gradient(to right, #91EAE4, #86A8E7, #7F7FD5);
        background: linear-gradient(to right, #91EAE4, #86A8E7, #7F7FD5);
        background-clip: text;
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
    }
    .container {
        height: 100%;
        display: flex;
    }
    #toolbar {
        display: flex;
        flex-direction: column;
        padding: 5px;
        width: 70px;
        background-color: #202020;
    }

    #toolbar * {
        margin-bottom: 6px;
    }

    #toolbar label {
        font-size: 12px;
    }

    #toolbar input {
        width: 100%;
    }

    #toolbar button {
        background-color: #1565c0;
        border: none;
        border-radius: 4px;
        color:white;
        padding: 2px;
    }
</style>
<script>
    const canvas = document.getElementById('drawing-board');
    const toolbar = document.getElementById('toolbar');
    const ctx = canvas.getContext('2d');
    const canvasOffsetX = canvas.offsetLeft;
    const canvasOffsetY = canvas.offsetTop;

    canvas.width = window.innerWidth - canvasOffsetX;
    canvas.height = window.innerHeight - canvasOffsetY;
    let isPainting = false;
    let lineWidth = 5;
    let startX;
    let startY;
    toolbar.addEventListener('click', e => {
        if (e.target.id === 'clear') {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    });
    toolbar.addEventListener('change', e => {
        if(e.target.id === 'stroke') {
            ctx.strokeStyle = e.target.value;
        }

        if(e.target.id === 'lineWidth') {
            lineWidth = e.target.value;
        }
    });
    canvas.addEventListener('mousedown', (e) => {
        isPainting = true;
        startX = e.clientX;
        startY = e.clientY;
    });

    canvas.addEventListener('mouseup', e => {
        isPainting = false;
        ctx.stroke();
        ctx.beginPath();
    });

    canvas.addEventListener('mousemove', draw);
    const draw = (e) => {
        if(!isPainting) {
            return;
        }

        ctx.lineWidth = lineWidth;
        ctx.lineCap = 'round';

        ctx.lineTo(e.clientX - canvasOffsetX, e.clientY);
        ctx.stroke();
    }
</script>#}
{% endblock %}
